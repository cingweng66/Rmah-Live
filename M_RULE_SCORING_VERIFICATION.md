# M规点数系统验证文档

## 修复内容总结

### 1. 切上满贯规则 ✅
**修复前**: 4番40符起按满贯计  
**修复后**: 4番30符起按满贯计（符合M规）

```typescript
// 修复后的满贯判定
if (h >= 5 || (h === 4 && f >= 30) || (h === 3 && f >= 70)) return 'mangan';
```

### 2. 20符和25符规则 ✅
- **20符**: 只存在2-4番（门清平和自摸），荣和不存在20符
- **25符**: 只存在2-4番（七对子）

### 3. 点数表格布局 ✅
- **纵向（行）**: 符数（20符、25符、30符、40符、50符）
- **横向（列）**: 番数（1番、2番、3番、4番）
- **显示格式**: 完整点数，使用千分位分隔符

### 4. 自摸点数显示 ✅
- **庄家自摸**: `4000 ALL` = 三家各支付4000点
- **子家自摸**: `4000/2000` = 庄家支付4000点，其余两家各支付2000点

---

## M规标准点数表验证

### 子家荣和点数表

| 符/番 | 1番 | 2番 | 3番 | 4番 |
|------|-----|-----|-----|-----|
| 20符 | - | - | - | - |
| 25符 | - | 1,600 | 3,200 | 6,400 |
| 30符 | 1,000 | 2,000 | 3,900 | 8,000 ★ |
| 40符 | 1,300 | 2,600 | 5,200 | 8,000 |
| 50符 | 1,600 | 3,200 | 6,400 | 8,000 |

★ 切上满贯

### 庄家荣和点数表

| 符/番 | 1番 | 2番 | 3番 | 4番 |
|------|-----|-----|-----|-----|
| 20符 | - | - | - | - |
| 25符 | - | 2,400 | 4,800 | 9,600 |
| 30符 | 1,500 | 2,900 | 5,800 | 12,000 ★ |
| 40符 | 2,000 | 3,900 | 7,700 | 12,000 |
| 50符 | 2,400 | 4,800 | 9,600 | 12,000 |

★ 切上满贯

### 子家自摸点数表

| 符/番 | 1番 | 2番 | 3番 | 4番 |
|------|-----|-----|-----|-----|
| 20符 | - | 700/400 | 1,300/700 | 2,600/1,300 |
| 25符 | - | 1,600/800 | 3,200/1,600 | 6,400/3,200 |
| 30符 | 500/300 | 1,000/500 | 2,000/1,000 | 4,000/2,000 ★ |
| 40符 | 700/400 | 1,300/700 | 2,600/1,300 | 4,000/2,000 |
| 50符 | 800/400 | 1,600/800 | 3,200/1,600 | 4,000/2,000 |

格式：庄家支付/子家支付  
★ 切上满贯

### 庄家自摸点数表

| 符/番 | 1番 | 2番 | 3番 | 4番 |
|------|-----|-----|-----|-----|
| 20符 | - | 700 ALL | 1,300 ALL | 2,600 ALL |
| 25符 | - | 800 ALL | 1,600 ALL | 3,200 ALL |
| 30符 | 500 ALL | 1,000 ALL | 2,000 ALL | 4,000 ALL ★ |
| 40符 | 700 ALL | 1,300 ALL | 2,600 ALL | 4,000 ALL |
| 50符 | 800 ALL | 1,600 ALL | 3,200 ALL | 4,000 ALL |

★ 切上满贯

---

## 快捷点数按钮验证

### 荣和快捷按钮

#### 子家荣和
- 1,000 (1番30符)
- 1,600 (2番25符)
- 2,000 (2番30符)
- 3,900 (3番30符)
- 8,000 (满贯)

#### 庄家荣和
- 1,500 (1番30符)
- 2,400 (2番25符)
- 2,900 (2番30符)
- 5,800 (3番30符)
- 12,000 (满贯)

### 自摸快捷按钮

#### 子家自摸（显示格式：庄家支付/子家支付）
- 1,000/500 (1番30符)
- 1,600/800 (2番25符)
- 2,000/1,000 (2番30符)
- 4,000/2,000 (3番30符)
- 4,000/2,000 (满贯)

#### 庄家自摸（显示格式：点数 ALL）
- 500 ALL (1番30符)
- 800 ALL (2番25符)
- 1,000 ALL (2番30符)
- 2,000 ALL (3番30符)
- 4,000 ALL (满贯)

---

## 计算验证示例

### 示例1：子家1番30符荣和
```
基础点数 = 30 × 2^(1+2) = 30 × 8 = 240
子家荣和 = 240 × 4 = 960 → 向上取整 = 1,000 ✓
```

### 示例2：庄家2番30符荣和
```
基础点数 = 30 × 2^(2+2) = 30 × 16 = 480
庄家荣和 = 480 × 6 = 2,880 → 向上取整 = 2,900 ✓
```

### 示例3：子家3番30符自摸
```
基础点数 = 30 × 2^(3+2) = 30 × 32 = 960
子家支付 = 960 × 1 = 960 → 向上取整 = 1,000
庄家支付 = 960 × 2 = 1,920 → 向上取整 = 2,000 ✓
显示: 2,000/1,000
```

### 示例4：4番30符切上满贯
```
4番30符 >= 满贯条件
子家荣和 = 8,000 ✓
庄家荣和 = 12,000 ✓
子家自摸 = 4,000/2,000 ✓
庄家自摸 = 4,000 ALL ✓
```

---

## 结算逻辑验证

### 荣和结算
1. 获胜者从放铳者获得基础点数
2. 加上本场奖励（300点/本场）
3. 加上供托奖励（1000点/根）

### 自摸结算
1. **庄家自摸**: 三家各支付相同点数
   - 每人支付 = 基础点数 × 2（向上取整）
   - 每人加本场 = 100点/本场
2. **子家自摸**: 
   - 其他子家各支付 = 基础点数 × 1（向上取整）
   - 庄家支付 = 基础点数 × 2（向上取整）
   - 每人加本场 = 100点/本场
3. 加上供托奖励（1000点/根）

### 本场计算
- **荣和**: 放铳者额外支付 300点 × 本场数
- **自摸**: 每人额外支付 100点 × 本场数

---

## 特殊役种点数

| 役种 | 番数 | 子家荣和 | 庄家荣和 | 子家自摸 | 庄家自摸 |
|------|------|----------|----------|----------|----------|
| 满贯 | 5番 | 8,000 | 12,000 | 4,000/2,000 | 4,000 ALL |
| 跳满 | 6-7番 | 12,000 | 18,000 | 6,000/3,000 | 6,000 ALL |
| 倍满 | 8-10番 | 16,000 | 24,000 | 8,000/4,000 | 8,000 ALL |
| 三倍满 | 11-12番 | 24,000 | 36,000 | 12,000/6,000 | 12,000 ALL |
| 役满 | 13番+ | 32,000 | 48,000 | 16,000/8,000 | 16,000 ALL |

---

## 测试清单

### 基础测试
- [x] 4番30符按满贯计算（切上满贯）
- [x] 20符只显示2-4番（荣和不显示20符）
- [x] 25符只显示2-4番
- [x] 30符、40符、50符显示1-4番
- [x] 点数表格纵向显示符数
- [x] 点数表格横向显示番数
- [x] 所有点数完整显示（不使用缩写）

### 荣和测试
- [x] 子家1番30符 = 1,000
- [x] 庄家1番30符 = 1,500
- [x] 子家4番30符 = 8,000（满贯）
- [x] 庄家4番30符 = 12,000（满贯）

### 自摸测试
- [x] 子家1番30符 = 1,000/500
- [x] 庄家1番30符 = 500 ALL
- [x] 子家4番30符 = 4,000/2,000（满贯）
- [x] 庄家4番30符 = 4,000 ALL（满贯）

### 快捷按钮测试
- [x] 荣和快捷按钮点数正确
- [x] 自摸快捷按钮点数正确
- [x] 自摸显示格式正确（子家：庄家支付/子家支付，庄家：点数 ALL）

### 结算预览测试
- [x] 荣和结算预览正确
- [x] 自摸结算预览正确
- [x] 本场和供托计算正确

---

## 更新日期
2026-01-13

## 版本
v2.2.0 - M规点数系统完整实现
